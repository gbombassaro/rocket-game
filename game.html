<!DOCTYPE html>
<html lang="pt-bt">
  <head>
    <title>Rocket Game</title>
    <meta charset="utf-8">
    <!-- <link rel='stylesheet' type='text/css' href='styles.css' title='General styles' /> -->
  </head>
  <body>
    <canvas id="minha-tela" width="800" height="400" style="border: #F00 solid 1px;"></canvas>
    <script>
      const canvasWidth = 800;
      const canvasHeight = 400;
      var canvas = document.getElementById('minha-tela');
      var context = canvas.getContext('2d');

      var minWidth = 40;
      var minHeight = 40;
      var maxWidth = 760;
      var maxHeight = 360;
      var counter = 0;

      var rocketX = 0;
      var rocketY = 150;
      var rocketWidth = 50;
      var rocketHeight = 50

      var objectX = 0;
      var objectY = 0;
      var objectWidth = 40;
      var objectHeight = 40;

      requestAnimationFrame(gameloop);

      //KEYS LISTENER
      window.onkeydown = press;
      function press(key) {
        if (key.keyCode == 37) {
          if (rocketX < 0) rocketX = rocketX + 15;
          rocketX = rocketX - 15;
        }
        if (key.keyCode == 38) {
          if (rocketY < 0) rocketY = rocketY + 15;
          rocketY = rocketY - 15;
        }
        if (key.keyCode == 39) {          
          if (rocketX > 750) rocketX = rocketX - 15;
          rocketX = rocketX + 15;
        }
        if (key.keyCode == 40) {
          if (rocketY > 350) rocketY = rocketY - 15;
          rocketY = rocketY + 15;
        }
      }

      //EXECUTE GAME
      function gameloop() {
        context.clearRect(0, 0, canvasWidth, canvasHeight);
        renderRocket(rocketX, rocketY);
        renderSquare(objectX, objectY);
        var colision = detectarColisao();
        if (colision === true ) {
          return null;
        } else {
          if (counter++%50==0) randomizer();
          requestAnimationFrame(gameloop);
        }
      }

      //RENDERS
      function renderSquare(positionX, positionY) {
        context.fillStyle = '#000';
        context.fillRect(positionX, positionY, objectWidth, objectHeight);
      }
      function renderRocket(pX, pY) {
        const img = new Image();
        img.src = "./rocket-emoji.png";
        context.drawImage(img, rocketX, rocketY, rocketWidth, rocketHeight);
        detectarColisao();
      }
      function randomizer() {
        objectX = Math.floor((Math.random() * (maxWidth - minWidth)) + minWidth);
        objectY = Math.floor((Math.random() * (maxHeight - minHeight)) + minHeight);
      }
      function detectarColisao() {
        if (((rocketX + rocketWidth) > objectX && rocketX < (objectX + objectWidth)) && ((rocketY + rocketHeight) > objectY && rocketY < (objectY + objectHeight))) {
          return true;          
        }
      }
    </script>
  </body>
</html>